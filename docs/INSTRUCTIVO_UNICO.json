{
  "metadata": {
    "title": "Coreboard ‚Äî Gu√≠a R√°pida",
    "path": "docs/INSTRUCTIVO_UNICO.md",
    "category": "guide",
    "tags": [
      "guide"
    ],
    "lastUpdated": "2025-11-15",
    "fileName": "INSTRUCTIVO_UNICO"
  },
  "content": "# Coreboard ‚Äî Gu√≠a R√°pida\r\n\r\n## Qu√© es\r\n- CRM para salones/peluquer√≠as\r\n- Gestiona turnos, clientes, empleados, servicios\r\n- Multi-org con Supabase\r\n\r\n## Instalar\r\n```bash\r\nnpm i\r\n```\r\n\r\n## Variables de entorno (.env)\r\n```\r\nNEXT_PUBLIC_SUPABASE_URL=tu_url\r\nNEXT_PUBLIC_SUPABASE_ANON_KEY=tu_key\r\n```\r\n\r\n## Ejecutar\r\n```bash\r\nnpm run dev\r\n```\r\n\r\nAbre http://localhost:3000\r\n\r\n## Estructura\r\n- `pages/` ‚Üí Rutas (login, dashboard)\r\n- `src/App.tsx` ‚Üí App principal\r\n- `src/components/` ‚Üí UI y features\r\n  - `views/` ‚Üí Vistas principales (Home, Finances, Settings, etc)\r\n  - `sections/` ‚Üí Secciones complementarias (Clients, Employees)\r\n  - `features/` ‚Üí Features complejos reutilizables\r\n    - `appointments/` ‚Üí Calendario, di√°logos de turnos\r\n    - `finances/` ‚Üí Gr√°ficos de finanzas\r\n  - `ui/` ‚Üí Componentes sin estado (Button, Card, etc)\r\n  - `empty-states/` ‚Üí Estados vac√≠os\r\n- `src/contexts/AuthContext.tsx` ‚Üí Autenticaci√≥n\r\n- `src/hooks/` ‚Üí Datos (appointments, salons, clients, employees, services, useTurnos)\r\n- `src/stores/` ‚Üí Estado global (turnosStore)\r\n- `src/lib/` ‚Üí Utilidades (supabase, employeeValidator, contextValidator, etc)\r\n- `infra/db/` ‚Üí Base de datos y RLS\r\n\r\n## Features\r\n- Calendario de turnos\r\n- Gesti√≥n de clientes/empleados\r\n- Servicios por sal√≥n\r\n- Autenticaci√≥n con Supabase\r\n- Multi-organizaci√≥n con RLS\r\n- Modo demo sin backend\r\n\r\n## Testing\r\n```bash\r\nnpx playwright test\r\n```\r\n\r\n## Build producci√≥n\r\n```bash\r\nnpm run build\r\nnpm start\r\n```\r\n\r\n## Datos principales\r\n- `organizations` ‚Üí Organizaciones\r\n- `salons` ‚Üí Locales\r\n- `services` ‚Üí Servicios\r\n- `clients` ‚Üí Clientes\r\n- `employees` ‚Üí Empleados (con `user_id` obligatorio)\r\n- `salon_employees` ‚Üí Asignaciones sal√≥n-empleado\r\n- `appointments` ‚Üí Turnos\r\n\r\n## Scripts disponibles\r\n```bash\r\nnode scripts/create_test_user.js      # Crear usuario de prueba\r\nnode scripts/invite_employee.js       # Invitar empleado\r\nnode scripts/create_invitation.js     # Crear invitaci√≥n gen√©rica\r\nnode scripts/reset_password.js        # Resetear contrase√±a\r\n```\r\n\r\nExcelente, arquitecto de aut√≥matas üòé\r\n\r\nTu IA ya qued√≥ con un **pipeline l√≥gico cerrado**. Eso significa que si ma√±ana le met√©s otro frontend, otro canal (WhatsApp, kioskito web, app mobile) o incluso un agente que crea turnos por voz, **todos van a pasar por la misma aduana l√≥gica**. Eso es exactamente lo que quer√≠amos.\r\n\r\nTe dejo el mapa de lo que ten√©s ahora y lo que pod√©s sumar despu√©s.\r\n\r\n---\r\n\r\n## üß† Lo que ya ten√©s\r\n\r\n1. **Context validator**\r\n\r\n   * No hay org fantasma. Si front y server no coinciden ‚Üí lo dice.\r\n\r\n2. **State manager de sal√≥n**\r\n\r\n   * Si est√°s cambiando de sal√≥n ‚Üí no te deja hacer cosas peligrosas.\r\n\r\n3. **Validator de turnos**\r\n\r\n   * No acepta turnos \"crudos\", solo los que respetan servicio, empleado, horario.\r\n\r\n4. **Permission resolver (RBAC ‚Üí acci√≥n)**\r\n\r\n   * No m√°s \"el empleado vio finanzas porque el front las mostraba\".\r\n\r\n5. **Demo adapter (demo que no miente)**\r\n\r\n   * Demo y real usan la misma l√≥gica de validaci√≥n. Demo no te enga√±a.\r\n\r\n6. **Operation validator**\r\n\r\n   * √önica puerta de entrada. 5 estados posibles, nada raro:\r\n\r\n   ```text\r\n   valido\r\n   invalido\r\n   inconsistente\r\n   inconsistente-temporal\r\n   rechazado-por-permisos\r\n   ```\r\n\r\n7. **Sistema global de turnos (turnosStore)**\r\n\r\n   * Estado centralizado para toda la l√≥gica de turnos: lista, filtros, validaciones, CRUD.\r\n   * Fuente √∫nica de verdad: todos los componentes consumen desde aqu√≠.\r\n   * Validaciones integradas: detecta conflictos de horarios, empleados no asignados, datos incompletos.\r\n   * Suscripci√≥n a cambios en tiempo real: actualizaci√≥n autom√°tica cuando hay cambios en BD.\r\n\r\n8. **Hook useTurnos**\r\n\r\n   * API simplificada para componentes: `turnos`, `loading`, `filters`, `createTurno`, `updateTurno`, `deleteTurno`.\r\n   * Selectores listos: `getByDate`, `getByStatus`, `getBySalon`, `getByEmployee`.\r\n   * Internamente usa `turnosStore` y se sincroniza con `useAppointments` durante la migraci√≥n.\r\n\r\n9. **Gesti√≥n real de empleados**\r\n\r\n   * Eliminado array de strings \"staff\" en salones.\r\n   * Asignaci√≥n real desde tabla `salon_employees` con checkboxes.\r\n   * Pre-carga de empleados asignados al editar sal√≥n.\r\n   * Validaci√≥n: empleado = usuario autenticado (regla de oro).\r\n\r\n10. **Validadores de empleados**\r\n\r\n    * `employeeValidator.ts`: centraliza reglas de negocio.\r\n    * Filtra empleados sin `user_id`.\r\n    * Valida asignaci√≥n activa a sal√≥n antes de crear turno.\r\n    * Integrado en `OrganizationView` y `SalonsManagementView`.\r\n\r\n---\r\n\r\n## üß™ Qu√© falta para un CRM ‚Äúprofesionalmente hincha pelotas‚Äù\r\n\r\nEsto ya es fase 2, pero te lo tiro porque s√© que vas a llegar ah√≠:\r\n\r\n1. **Auditor√≠a**\r\n\r\n   * cada rechazo deber√≠a dejar: qui√©n, qu√© operaci√≥n, por qu√©, en qu√© org\r\n   * esto despu√©s lo lee un panel de admins\r\n\r\n2. **Sugeridor de alternativas**\r\n\r\n   * cuando el turno es inv√°lido por choque de horario, devolver huecos cercanos\r\n   * esto lo puede hacer otro agente usando el mismo contexto validado\r\n\r\n3. **Normalizador de payloads**\r\n\r\n   * hoy asumimos que todos mandan el mismo shape\r\n   * cre√° un paso ‚Äúnormalize‚Äù antes del validador (por si ma√±ana viene otro canal)\r\n\r\n4. **Pol√≠ticas por sal√≥n**\r\n\r\n   * ahora todo es por org\r\n   * algunos salones van a querer reglas propias (ej. ‚Äúno turnos sin tel√©fono‚Äù)\r\n\r\n---\r\n\r\n## üß¨ Por qu√© esto est√° bueno de verdad\r\n\r\nPorque lograste separar:\r\n\r\n* **qui√©n puede** (permissionResolver)\r\n* **d√≥nde puede** (contextValidator + sal√≥n)\r\n* **qu√© puede** (appointmentValidator)\r\n* **cu√°ndo puede** (contextStateManager)\r\n* **en qu√© entorno** (demoAdapter)\r\n\r\nEso es dise√±o de agentes con cabeza. Cada uno hace UNA cosa. Si ma√±ana met√©s un ‚Äúagente de notificaciones‚Äù o un ‚Äúagente de IA que completa turno por voz‚Äù, lo √∫nico que tiene que hacer es **llamar al operation validator** y dejar que √©l decida.\r\n\r\nEl mundo m√°s ordenado, la UI m√°s libre, y vos con menos tickets raros.\r\n\r\nSegu√≠s vos ahora con la parte sexy: usar esto para automatizar turnos desde canales externos. Ese es el pr√≥ximo nivel üßó‚Äç‚ôÇÔ∏è\r\n\r\n---\r\n\r\n## üìã Cambios Recientes (Refactorizaci√≥n)\r\n\r\n### Sistema Global de Turnos\r\n- **`src/stores/turnosStore.ts`**: Estado centralizado para turnos (lista, filtros, validaciones, CRUD).\r\n- **`src/hooks/useTurnos.ts`**: Hook de alto nivel para componentes (API simplificada).\r\n- **Migraci√≥n gradual**: Componentes migrados a `useTurnos` manteniendo compatibilidad con `useAppointments`.\r\n\r\n### Gesti√≥n de Empleados\r\n- **`src/lib/employeeValidator.ts`**: Validaciones centralizadas (user_id obligatorio, asignaci√≥n activa a sal√≥n).\r\n- **`SalonsManagementView`**: Refactorizado para usar empleados reales desde BD con checkboxes.\r\n- **Regla de oro**: Empleado = Usuario autenticado. No existe empleado sin `user_id`.\r\n\r\n### Componentes Migrados\r\n- `App.tsx`, `AppointmentDialog.tsx`, `TurnosPanel.tsx`, `CalendarView.tsx`, `ClientsPanel.tsx`\r\n- `HomeView.tsx`, `OwnerDashboard.tsx`, `ClientDashboard.tsx`, `OperationsDashboard.tsx`, `SalesMarketingDashboard.tsx`\r\n- `useFinancialMetrics.ts`, `useFinancialAlerts.ts`\r\n\r\n### Base de Datos\r\n- Tabla `salon_employees`: Asignaciones sal√≥n-empleado (many-to-many).\r\n- Validaci√≥n en BD: `user_id` √∫nico por organizaci√≥n en `employees`.\r\n- Soft deletion: Suspensi√≥n/inactivaci√≥n sin borrar registros.\r\n",
  "sections": []
}